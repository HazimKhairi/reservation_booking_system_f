{% extends 'base.html' %}

{% block title %}Edit Room - Library Room Reservation{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Edit Room</h1>
    <p class="page-subtitle">Update room information</p>
</div>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Room Details</h3>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('admin_edit_room', room_id=room.id) }}">
            <div class="form-group">
                <label class="form-label" for="name">Room Name</label>
                <input type="text" id="name" name="name" class="form-control" value="{{ room.name }}" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="capacity">Capacity (people)</label>
                    <input type="number" id="capacity" name="capacity" class="form-control" min="1"
                        value="{{ room.capacity }}" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="price_per_hour">Price per Hour (RM)</label>
                    <input type="number" id="price_per_hour" name="price_per_hour" class="form-control" min="0"
                        step="0.01" value="{{ room.price_per_hour if room.price_per_hour else '10.00' }}" required>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="status">Status</label>
                <select id="status" name="status" class="form-control" required>
                    <option value="available" {% if room.status=='available' %}selected{% endif %}>Available
                    </option>
                    <option value="maintenance" {% if room.status=='maintenance' %}selected{% endif %}>Maintenance
                    </option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Equipment</label>
                <input type="hidden" id="equipmentHidden" name="equipment" value="{{ room.equipment or '' }}">

                <div class="multi-select-dropdown">
                    <div class="multi-select-btn" onclick="toggleDropdown()">
                        <span id="selectedCount">Select Equipment</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>
                    <div class="multi-select-options" id="equipmentOptions">
                        <label class="checkbox-option">
                            <input type="checkbox" value="Projector" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            Projector
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="Whiteboard" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            Whiteboard
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="Video Conference" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            Video Conference
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="TV/Monitor" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            TV/Monitor
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="Speakers" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            Speakers
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="Microphone" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            Microphone
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="Webcam" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            Webcam
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="Air Conditioning" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            Air Conditioning
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="WiFi" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            WiFi
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="Power Outlets" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            Power Outlets
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="Computer/PC" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            Computer/PC
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="Printer" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            Printer
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="Flipchart" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            Flipchart
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" value="Podium" onchange="updateSelection()">
                            <span class="checkmark"></span>
                            Podium
                        </label>
                    </div>
                </div>
            </div>

            <div class="mt-20">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> Update Room
                </button>
                <a href="{{ url_for('admin_rooms') }}" class="btn btn-outline">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<style>
    .multi-select-dropdown {
        position: relative;
        width: 100%;
    }

    .multi-select-btn {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: border-color 0.2s, box-shadow 0.2s;
    }

    .multi-select-btn:hover {
        border-color: #3b82f6;
    }

    .multi-select-btn.active {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .dropdown-icon {
        transition: transform 0.2s;
        color: #666;
    }

    .multi-select-btn.active .dropdown-icon {
        transform: rotate(180deg);
    }

    .multi-select-options {
        position: absolute;
        top: calc(100% + 4px);
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        max-height: 250px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .multi-select-options.show {
        display: block;
    }

    .checkbox-option {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        cursor: pointer;
        transition: background 0.2s;
        border-bottom: 1px solid #f0f0f0;
        margin: 0;
        font-weight: normal;
    }

    .checkbox-option:last-child {
        border-bottom: none;
    }

    .checkbox-option:hover {
        background: #f8fafc;
    }

    .checkbox-option input[type="checkbox"] {
        display: none;
    }

    .checkbox-option .checkmark {
        width: 20px;
        height: 20px;
        border: 2px solid #ddd;
        border-radius: 4px;
        margin-right: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        flex-shrink: 0;
    }

    .checkbox-option input[type="checkbox"]:checked + .checkmark {
        background: #3b82f6;
        border-color: #3b82f6;
    }

    .checkbox-option input[type="checkbox"]:checked + .checkmark::after {
        content: 'âœ“';
        color: white;
        font-size: 14px;
        font-weight: bold;
    }
</style>

<script>
    function toggleDropdown() {
        const btn = document.querySelector('.multi-select-btn');
        const options = document.getElementById('equipmentOptions');
        btn.classList.toggle('active');
        options.classList.toggle('show');
    }

    function updateSelection() {
        const checkboxes = document.querySelectorAll('#equipmentOptions input[type="checkbox"]');
        const hidden = document.getElementById('equipmentHidden');
        const countDisplay = document.getElementById('selectedCount');

        const selected = Array.from(checkboxes)
            .filter(cb => cb.checked)
            .map(cb => cb.value);

        hidden.value = selected.join(', ');

        if (selected.length === 0) {
            countDisplay.textContent = 'Select Equipment';
        } else {
            countDisplay.textContent = selected.length + ' Selected';
        }
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function (e) {
        if (!e.target.closest('.multi-select-dropdown')) {
            const btn = document.querySelector('.multi-select-btn');
            const options = document.getElementById('equipmentOptions');
            btn.classList.remove('active');
            options.classList.remove('show');
        }
    });

    // Pre-select options based on existing equipment
    document.addEventListener('DOMContentLoaded', function () {
        const hidden = document.getElementById('equipmentHidden');
        const existingEquipment = hidden.value.trim();

        if (existingEquipment) {
            const equipmentList = existingEquipment.split(',').map(e => e.trim());
            const checkboxes = document.querySelectorAll('#equipmentOptions input[type="checkbox"]');

            checkboxes.forEach(cb => {
                if (equipmentList.includes(cb.value)) {
                    cb.checked = true;
                }
            });

            updateSelection();
        }
    });
</script>
{% endblock %}